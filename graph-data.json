---
# 이 두 줄은 Jekyll이 이 파일을 처리하도록 하는 데 필요합니다.
layout: null 
---
{%- comment -%}
  각종 변수들을 초기화합니다.
  nodes: 태그 이름 목록 (중복 없음)
  edges: 태그 간의 연결 목록
  tag_counts: 태그별 사용 횟수
{%- endcomment -%}
{%- assign all_tags = "" | split: "," -%}
{%- for post in site.posts -%}
  {%- for tag in post.tags -%}
    {%- assign all_tags = all_tags | push: tag -%}
  {%- endfor -%}
{%- endfor -%}

{%- assign unique_tags = all_tags | uniq -%}

{
  "nodes": [
    {%- for tag in unique_tags -%}
      {%- assign count = all_tags | where: tag | size -%}
      {
        "id": "{{ tag | escape }}",
        "label": "{{ tag | escape }}",
        "value": {{ count }}
      }
      {%- unless forloop.last -%},{%- endunless -%}
    {%- endfor -%}
  ],
  "edges": [
    {%- assign processed_edges = "" | split: "," -%}
    {%- for post in site.posts -%}
      {%- if post.tags.size > 1 -%}
        {%- for tag1 in post.tags -%}
          {%- for tag2 in post.tags -%}
            {%- if tag1 != tag2 -%}
              {%- assign edge_pair = tag1 | append: '--' | append: tag2 -%}
              {%- assign reverse_edge_pair = tag2 | append: '--' | append: tag1 -%}
              {%- unless processed_edges contains edge_pair or processed_edges contains reverse_edge_pair -%}
                {
                  "from": "{{ tag1 | escape }}",
                  "to": "{{ tag2 | escape }}"
                }
                {%- assign processed_edges = processed_edges | push: edge_pair -%},
              {%- endunless -%}
            {%- endif -%}
          {%- endfor -%}
        {%- endfor -%}
      {%- endif -%}
    {%- endfor -%}
    {}
  ]
}
